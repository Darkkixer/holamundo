<!DOCTYPE html>

<html>
<head>
<meta http-equiv="Content-type" content="text/html;
charset=utf-8">
<meta name="viewport" id="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>

<script type="text/javascript" charset="utf-8">
function onBodyLoad() {
document.addEventListener("deviceready",onDeviceReady,
false);
}
function onDeviceReady() {

window.alert("Loading PhoneGap is completed");
        }

        // Un Reproductor de audio
        //
        var my_media = null;
        var mediaTimer = null;

        // Reproduce el audio
        //
        function playAudio() {
                var src = 'love_rain.mp3';
             media = new Media (getPath() + src , onSuccess, onError);

            //Play the audio. You can set number of the replaying time here.
            media.play({numberOfLoops:"infinite"});

            if (mediaTimer == null) {

                mediaTimer = setInterval(function() {

                    // Return a current playback position
                    media.getCurrentPosition(

                        //A Callback function if it's success
                        function(position) {
                            if (position > -1) {
                                setAudioPosition((position) + " sec");
                                             
                                        //If the playback stops at "-0.001" position, replay the audio.
                                        if(position == -0.001){

                                            media.play({numberOfLoops:"infinite"});
            
                                        }
                            }
                        },
                        //A callback function in case of failure
                        function(e) {

                            console.log("Error getting pos=" + e);
                            setAudioPosition("Error: " + e);

                        }
                    );
                }, 1000);
            }
        }

        function pauseAudio() {

            if (media) {
                media.pause();
            }
        }

        function stopAudio() {

            if (media) {
                media.stop();
            }

            clearInterval(mediaTimer);
            mediaTimer = null;
        }

          //A success callback function displaying a success message.
          function onSuccess() {
              console.log("playAudio():Audio Success");
          }

          //A callback function in case of failure
          function onError(error) {
              alert('code: '    + error.code    + '\n' + 
                    'message: ' + error.message + '\n');
          }

          //Set the position of audio playback
          function setAudioPosition(position) {
              document.getElementById('audio_position').innerHTML = position;
          }

          </script>
        </head>
      <body>
      <h1>Escucha music con PhoneGap</h1>
        <a href="#" class="btn large" onclick="playAudio('love_rain');">Play </a><br/><br/><br/>

        <a href="#" class="btn large" onclick="pauseAudio();">Pausa/a><br/><br/><br/>

        <a href="#" class="btn large" onclick="stopAudio();">Stop </a><br/><br/><br/>

        <p id="audio_position"></p><br/>
       
</body>
</html>
